# =============================================================================
# IT-DIA-PARTIAL-FRAG: DIA-PASEF with Partial Fragmentation (Unfragmented Precursors)
# =============================================================================
# Tests the precursor survival feature where a fraction of precursor ions
# remain unfragmented during MS2. This simulates incomplete fragmentation
# observed in real experiments.
#
# Precursor survival: 0-30% of precursors survive fragmentation intact
# =============================================================================

[test_metadata]
test_id = "IT-DIA-PARTIAL-FRAG"
description = "DIA-PASEF with partial fragmentation - up to 30% unfragmented precursors"
acquisition_type = "DIA"
sample_type = "hela"
analysis_tools = ["diann", "fragpipe"]

[thresholds]
# ID rate may be slightly lower due to unfragmented precursors
min_id_rate = 0.25
min_rt_correlation = 0.95
min_im_correlation = 0.95

# -----------------------------------------------------------------------------
# Paths - Resolved from env.toml at runtime
# -----------------------------------------------------------------------------
[paths]
save_path = "${output_base}/IT-DIA-PARTIAL-FRAG"
reference_path = "${reference_dia}"
fasta_path = "${fasta_hela}"
modifications = ""
existing_path = ""

# -----------------------------------------------------------------------------
# Experiment settings
# -----------------------------------------------------------------------------
[experiment]
experiment_name = "IT-DIA-PARTIAL-FRAG"
acquisition_type = "DIA"
gradient_length = 3600.0
use_reference_layout = true
reference_in_memory = false
use_bruker_sdk = true
apply_fragmentation = true
from_existing = false
silent_mode = false

# -----------------------------------------------------------------------------
# Digestion settings
# -----------------------------------------------------------------------------
[digestion]
n_proteins = 20000
num_peptides_total = 500000
num_sample_peptides = 150000
sample_peptides = true
sample_seed = 42
digest_proteins = true
remove_degenerate_peptides = false
cleave_at = "KR"
restrict = "P"
missed_cleavages = 2
min_len = 7
max_len = 30
decoys = false
upscale_factor = 100000

# -----------------------------------------------------------------------------
# Prediction models
# -----------------------------------------------------------------------------
[models]
rt_model = ""
ccs_model = ""
intensity_model = ""

# -----------------------------------------------------------------------------
# Retention time settings
# -----------------------------------------------------------------------------
[retention_time]
min_rt_percent = 2.0
exclude_accumulated_gradient_start = true
target_p = 0.999
sampling_step_size = 0.0001
n_steps = 1000
remove_epsilon = 0.0001

# -----------------------------------------------------------------------------
# Ion mobility settings
# -----------------------------------------------------------------------------
[ion_mobility]
use_inverse_mobility_std_mean = true
inverse_mobility_std_mean = 0.009

# -----------------------------------------------------------------------------
# Charge states
# -----------------------------------------------------------------------------
[charge_states]
p_charge = 0.5
max_charge = 4
min_charge_contrib = 0.25
binomial_charge_model = true
normalize_charge_states = true
charge_state_one_probability = 0.0

# -----------------------------------------------------------------------------
# Isotopic pattern
# -----------------------------------------------------------------------------
[isotopic_pattern]
isotope_k = 8
isotope_min_intensity = 1
isotope_centroid = true

# -----------------------------------------------------------------------------
# Fragment intensity
# -----------------------------------------------------------------------------
[fragment_intensity]
down_sample_factor = 0.5

# -----------------------------------------------------------------------------
# Noise settings
# -----------------------------------------------------------------------------
[noise]
noise_frame_abundance = false
noise_scan_abundance = false
mz_noise_precursor = true
precursor_noise_ppm = 6.5
mz_noise_fragment = true
fragment_noise_ppm = 6.5
mz_noise_uniform = false
add_real_data_noise = true
reference_noise_intensity_max = 150000
precursor_sample_fraction = 0.2
fragment_sample_fraction = 0.2
num_precursor_noise_frames = 5
num_fragment_noise_frames = 5

# -----------------------------------------------------------------------------
# Variation settings
# -----------------------------------------------------------------------------
[variation]
re_scale_rt = false

# -----------------------------------------------------------------------------
# Acquisition settings
# -----------------------------------------------------------------------------
[acquisition]
round_collision_energy = true
collision_energy_decimals = 0

# -----------------------------------------------------------------------------
# Proteome mix settings
# -----------------------------------------------------------------------------
[proteome_mix]
proteome_mix = false

# -----------------------------------------------------------------------------
# Phosphorylation settings
# -----------------------------------------------------------------------------
[phosphorylation]
phospho_mode = false

# -----------------------------------------------------------------------------
# Quad transmission settings - PARTIAL FRAGMENTATION
# -----------------------------------------------------------------------------
[quad_transmission]
quad_isotope_transmission_mode = "none"
quad_transmission_min_probability = 0.5
quad_transmission_max_isotopes = 10
# Precursor survival: fraction of precursors that remain unfragmented
# min=0.0, max=0.3 means 0-30% of precursors survive fragmentation intact
precursor_survival_min = 0.0
precursor_survival_max = 0.3

# -----------------------------------------------------------------------------
# Performance settings
# -----------------------------------------------------------------------------
[performance]
num_threads = -1
batch_size = 256
frame_batch_size = 500
lazy_frame_assembly = false
use_gpu = false
gpu_memory_limit_gb = 4

# -----------------------------------------------------------------------------
# Logging settings
# -----------------------------------------------------------------------------
[logging]
log_level = "INFO"
log_file = ""

# -----------------------------------------------------------------------------
# Video settings - Generate preview video for visual inspection
# -----------------------------------------------------------------------------
[video_settings]
generate_preview_video = true
preview_video_max_frames = 100
preview_video_fps = 10
preview_video_dpi = 80
preview_video_annotate = true
